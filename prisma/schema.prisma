generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  profile   Profile?
  foodLogs  FoodLog[]
  progressLogs ProgressLog[]
}

model ProgressLog {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  date      DateTime
  weight    Float
  waistSize Float?
  notes     String?
  createdAt DateTime @default(now())
}

model Profile {
  id            String   @id @default(uuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  height        Float    // in cm
  weight        Float    // in kg
  activityLevel String   // sedentary, light, moderate, active, very_active
  goal          String   // lose_weight, maintain, gain_muscle
  gender        String
  birthDate     DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  likedFoods    String   @default("") // Comma separated list of food IDs or names
  dailyMeals    Int      @default(4)
}

model FoodLog {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  date      DateTime
  mealType  String   // breakfast, lunch, dinner, snack
  foodName  String
  calories  Int
  protein   Float
  carbs     Float
  fat       Float
  createdAt DateTime @default(now())
}

model FoodItem {
  id             String   @id @default(uuid())
  name           String   @unique
  nameEs         String?
  barcode        String?  @unique
  brand          String?
  caloriesPer100g Int
  proteinPer100g Float
  carbsPer100g   Float
  fatPer100g     Float
  category       String?
  servingSize    Float?   // grams per serving unit (e.g. 30g per slice)
  servingUnit    String?  // e.g. "slice", "unit", "cup"
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  recipeIngredients RecipeIngredient[]
}

model Recipe {
  id            String   @id @default(uuid())
  name          String
  nameEs        String?
  description   String?
  instructions  String   // Stored as markdown or simple text steps
  prepTime      Int      // in minutes
  cookTime      Int      // in minutes
  servings      Int
  calories      Int
  protein       Float
  carbs         Float
  fat           Float
  tags          String   // Comma separated tags: "Breakfast,HighProtein,Vegan"
  image         String?  // URL or path to image
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  ingredients   RecipeIngredient[]
}

model RecipeIngredient {
  id        String   @id @default(uuid())
  recipeId  String
  recipe    Recipe   @relation(fields: [recipeId], references: [id])
  foodId    String?
  food      FoodItem? @relation(fields: [foodId], references: [id])
  name      String   // Name of ingredient if not linked to FoodItem, or override
  amount    Float
  unit      String
}
